<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
    <title>Hello, world!</title>

    <style>
    </style>
  </head>
  <body>

    <nav class="navbar navbar-light bg-light d-flex justify-content-start" id="nav_bar">
      <a href="#" class="btn btn-outline-danger btn-sm">æ­Œè¯</a>
      <!-- <a href="#" class="btn btn-outline-success btn-sm">å€’è®¡æ—¶</a> -->
      <!-- <a href="#" class="btn btn-outline-warning btn-sm">æŠ½ç­¾</a> -->
      <!-- <a href="#" class="btn btn-outline-primary btn-sm">op 4</a>
      <a href="#" class="btn btn-outline-dark btn-sm">op 5</a> -->
    </nav>

    <div class="container-fluid">      
      <div class="row justify-content-md-center">
        <div class="col-8">
          
          <h3>æ­Œè¯æ’ç‰ˆå·¥å…·</h3>
          <p>è¯·å°†æ­Œè¯<strong>è°ƒæ•´</strong>ä¸ºå¦‚ä¸‹æ ¼å¼çš„æ–‡æœ¬ï¼Œ<strong>ç²˜è´´</strong>åˆ°ä¸‹æ–¹â€œæ­Œè¯è¾“å…¥æ¡†â€ï¼Œ<strong>ç‚¹å‡»</strong>æŒ‰é’®ï¼Œå³å¯ã€‚<small style="color:red">ï¼ˆé¦–è¡Œä¸ºæ®µè½æ ‡è®°ï¼›ä»¥ç©ºè¡Œåˆ†éš”ä¸åŒé¡µé¢çš„å†…å®¹ï¼‰</small></p>
          <pre>- - - ä¸‹é¢ä¸ºç¤ºä¾‹ğŸ‘‡ - - -
1

1V1
é¹…ï¼Œé¹…ï¼Œé¹… æ›²é¡¹å‘å¤©æ­Œ
ç™½æ¯›æµ®ç»¿æ°´ çº¢æŒæ‹¨æ¸…æ³¢

1V2
æœè¾ç™½å¸å½©äº‘é—´ åƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜
ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ è½»èˆŸå·²è¿‡ä¸‡é‡å±±
- - - ä¸Šé¢ä¸ºç¤ºä¾‹ğŸ‘† - - -</pre>
          <div class="form-floating">
            <textarea class="form-control" placeholder="æ­Œè¯" id="lyrics" style="height: 500px"></textarea>
            <label for="lyrics">æ­Œè¯è¾“å…¥æ¡†</label>
          </div>
          
          <br/>

          <button type="button" class="btn btn-success" id="generate" onclick="generate_ppt(document.getElementById('lyrics').value);">ç”ŸæˆPPT</button>
          
        </div>
      </div>

      
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>

    <!-- JSZip JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js" integrity="sha512-xQBQYt9UcgblF6aCMrwU1NkVA7HCXaSN2oq0so80KO+y68M+n64FOcqgav4igHe6D5ObBLIf68DWv+gfBowczg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- PptxGenJS JS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.9.0/libs/jszip.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.9.0/dist/pptxgen.min.js"></script>
    
    <!-- ä¸»é€»è¾‘ -->
    <script type="text/javascript">
      // ä¸ºDateåŸå‹æ·»åŠ æ—¥æœŸæ ¼å¼åŒ–æ–¹æ³•
      Date.prototype.format = function(fmt) {
          var o = {
              "M+" : this.getMonth()+1,                 //æœˆä»½ 
              "d+" : this.getDate(),                    //æ—¥ 
              "h+" : this.getHours(),                   //å°æ—¶ 
              "m+" : this.getMinutes(),                 //åˆ† 
              "s+" : this.getSeconds(),                 //ç§’ 
              "q+" : Math.floor((this.getMonth()+3)/3), //å­£åº¦ 
              "S"  : this.getMilliseconds()             //æ¯«ç§’ 
          };
          if(/(y+)/.test(fmt)) {
                  fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
          }
          for(var k in o) {
              if(new RegExp("("+ k +")").test(fmt)){
                  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
              }
          }
          return fmt;
      }

      // è¾“å…¥è§£æã€‚ç§»é™¤ä¸€äº›å¤šä½™çš„æ¢è¡Œã€ç©ºæ ¼
      function parse_lyrics(text) {
        let paras = text.trim().replaceAll(/ *(\n *){2,}/g, "\n\n").split("\n\n").filter(item => item);
        console.log("paras: " + paras);
        let lyrics = [];
        let char_cnt = {"ä½ ": 0, "ç¥¢": 0, "ä»–": 0, "ç¥‚": 0};
        for (let para of paras) {
          let ary = para.replaceAll(/ *\n */g, "\n").split("\n");
          console.log(ary);
          lyrics.push([ary[0], ary.slice(1).join("\n"), "(END)"]);
          for (let key in char_cnt) {
            char_cnt[key] += (para.match(new RegExp(key, "g")) || []).length;
          }
        }
        for (let i = 0; i < lyrics.length - 1; i++) {
          lyrics[i][2] = "(" + lyrics[i+1][0] + ")";
        }
        return [lyrics.length != 0, lyrics, char_cnt];
      }

      // ç”ŸæˆPPT
      function generate_ppt(text) {
        let [status, lyrics, char_cnt] = parse_lyrics(text);
        if (status) {
          console.log("lyrics:\n" + lyrics);

          let pptx = new PptxGenJS();
          pptx.layout = "LAYOUT_WIDE"; // å¸ƒå±€ï¼šLAYOUT_16x10, LAYOUT_4x3

          for (let para of lyrics) {
            let slide = pptx.addSlide();
            slide.background = { color: "000000" };
            // æ­Œè¯
            slide.addText(para[1], {
                x: "0%",
                y: "16%",
                w: "100%",
                h: "70%",
                color: "FFFFFF",
                lang: "zh-CN",
                charSpacing: 2, // å­—ç¬¦é—´è·ï¼š1-256
                lineSpacingMultiple: 1.4, // è¡Œé—´è·ï¼ˆå€ï¼‰ï¼š0.0-9.99
                fontFace: "Heiti",
                bold: true,
                fontSize: 42,
                valign: "top",
                align: "center",
            });
            // å½“å‰æ®µè½æ ‡è®°
            slide.addText(para[0], {
                x: "2%",
                y: "87%",
                w: "20%",
                h: "10%",
                color: "FFFFFF",
                lang: "zh-CN",
                charSpacing: 2, // å­—ç¬¦é—´è·ï¼š1-256
                lineSpacingMultiple: 1.2, // è¡Œé—´è·ï¼ˆå€ï¼‰ï¼š0.0-9.99
                fontFace: "Calibri",
                bold: false,
                fontSize: 24,
                valign: "top",
                align: "left",
            });
            // ä¸‹ä¸€æ®µè½æ ‡è®°
            slide.addText(para[2], {
                x: "78%",
                y: "87%",
                w: "20%",
                h: "10%",
                color: "FFFFFF",
                lang: "zh-CN",
                charSpacing: 2, // å­—ç¬¦é—´è·ï¼š1-256
                lineSpacingMultiple: 1.2, // è¡Œé—´è·ï¼ˆå€ï¼‰ï¼š0.0-9.99
                fontFace: "Calibri",
                bold: false,
                fontSize: 24,
                valign: "top",
                align: "right",
            });
          }
          
          alert("è¯·ä»”ç»†æ ¡å¯¹ä¸€éï¼ˆå­—ç¬¦ç»Ÿè®¡ï¼šä½ ="+char_cnt["ä½ "]+"ï¼Œç¥¢="+char_cnt["ç¥¢"]+"ï¼Œä»–="+char_cnt["ä»–"]+"ï¼Œç¥‚="+char_cnt["ç¥‚"]+"ï¼‰");
          pptx.writeFile({ fileName: "æ­Œè¯"+(new Date()).format("yyyy-MM-dd")+".pptx" });
        } else {
          alert("è¾“å…¥é”™è¯¯ï¼šlyrics.length == "+lyrics.length);
        }
      };

    </script>

  </body>
</html>

<!-- 
æ–‡æ¡£ï¼š
1. Bootstrapï¼šhttps://getbootstrap.com/docs/5.1/customize/overview/
2. PptxGenJSï¼šhttps://gitbrent.github.io/PptxGenJS/docs/usage-pres-create/
3. - é¡µé¢æ ·å¼æ–‡æ¡£ï¼šhttps://gitbrent.github.io/PptxGenJS/docs/api-text/
4. JS stringæ–¹æ³•ï¼šhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String
 -->
